{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "Nuclear Physics Energy Spectra (NPESv1)",
	"description": "JSON Schema to store nuclear physics spectrum data. Mostly used for gamma spectroscopy.",
	"type": "object",
	"properties": {
		"schemaVersion": {
			"const": "NPESv1",
			"description": "Version string of the JSON Schema used.",
			"title": "Schema Version"
		},
		"deviceData": {
			"$ref": "#/definitions/DeviceData"
		},
		"sampleInfo": {
			"$ref": "#/definitions/SampleInfo"
		},
		"resultData": {
			"$ref": "#/definitions/ResultData"
		}
	},
	"required": [
		"schemaVersion",
		"resultData"
	],
	"additionalProperties": false,
	"definitions": {
		"DeviceData": {
			"type": "object",
			"additionalProperties": true,
			"properties": {
				"deviceName": {
					"type": "string",
					"description": "The name of the recording device."
				},
				"softwareName": {
					"type": "string",
					"description": "The name of the software that is used for recording.",
					"minLength": 1
				}
			},
			"required": [
				"softwareName"
			],
			"title": "Device Data",
			"description": "Metadata and other information about the recording device."
		},
		"ResultData": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"startTime": {
					"type": "string",
					"format": "date-time",
					"description": "Date and time of the recording start. Depends on 'endTime'!",
					"examples": ["2018-11-13T20:20:39+00:00"]
				},
				"endTime": {
					"type": "string",
					"format": "date-time",
					"description": "Date and time of the recording end. Depends on 'startTime'!",
					"examples": ["2018-11-13T20:20:39+00:00"]
				},
				"energySpectrum": {
					"$ref": "#/definitions/EnergySpectrum"
				},
				"backgroundEnergySpectrum": {
					"$ref": "#/definitions/EnergySpectrum"
				}
			},
			"anyOf": [
				{"required": ["energySpectrum"]},
				{"required": ["backgroundEnergySpectrum"]}
			],
			"dependencies": {
				"startTime": ["endTime"],
				"endTime": ["startTime"]
			},
			"title": "Result Data",
			"description": "The resulting measurement data from recording."
		},
		"EnergySpectrum": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"numberOfChannels": {
					"type": "integer",
					"minimum": 1,
					"description": "The number of channels or bins in the histogram.",
					"examples": [4096]
				},
				"energyCalibration": {
					"$ref": "#/definitions/EnergyCalibration"
				},
				"validPulseCount": {
					"type": "integer",
					"minimum": 1,
					"description": "The number of total valid pulses in the spectrum, i.e. total counts - invalid counts."
				},
				"measurementTime": {
					"type": "integer",
					"minimum": 1,
					"description": "Total measurement time in seconds.",
					"default": 1
				},
				"spectrum": {
					"type": "array",
					"items": {
						"type": "integer",
						"minimum": 0,
						"description": "A single histogram bin from the spectrum."
					},
					"minItems": 1,
					"description": "The complete energy spectrum as an array of individual bins."
				}
			},
			"required": [
				"numberOfChannels",
				"spectrum"
			],
			"title": "Energy Spectrum",
			"description": "Contains all the data specific to the (background) energy spectrum."
		},
		"EnergyCalibration": {
			"type": "object",
			"additionalProperties": false,
			"properties": {
				"polynomialOrder": {
					"type": "integer",
					"description": "Order of the polynomial used for calibration, e.g. order 2 for a + bx +cx^2.",
					"minimum": 1
				},
				"coefficients": {
					"type": "array",
					"items": {
						"type": "number",
						"description": "An individual calibration coefficient; can be any float."
					},
					"minItems": 1,
					"description": "All the coefficients needed for the n-poly calibration, sorted from lowest to highest order."
				}
			},
			"required": [
				"coefficients",
				"polynomialOrder"
			],
			"title": "Energy Calibration",
			"description": "All the data used for energy calibration of the spectrum."
		},
		"SampleInfo": {
			"type": "object",
			"additionalProperties": true,
			"properties": {
				"name": {
					"type": "string",
					"description": "Name of the measured sample."
				},
				"location": {
					"type": "string",
					"description": "Location where the sample was collected."
				},
				"time": {
					"type": "string",
					"format": "date-time",
					"description": "Date and time when the sample was collected.",
					"examples": ["2018-11-13T20:20:39+00:00"]
				},
				"weight": {
					"type": "number",
					"minimum": 0,
					"description": "Weight of the sample in grams."
				},
				"volume": {
					"type": "number",
					"minimum": 0,
					"description": "Volume of the sample in cubic centimeters."
				},
				"note": {
					"type": "string",
					"description": "Some other arbitrary notes on the sample."
				}
			},
			"title": "Sample Info",
			"description": "All the data surrounding the sample itself."
		}
	}
}
